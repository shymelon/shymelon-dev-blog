---
title: Мой опыт написания приложений на платформе VK mini apps. Плюсы, минусы, подводные камни.
date: 2020-08-04
layout: post
---

# Мой опыт написания приложений на платформе VK mini apps. Плюсы, минусы, подводные камни.
Йоу, в этой статье я хочу поделиться опытом разработки под мини приложения вконтакте, с какими проблемами столкнулся и всем этим. Для написания этой статьи меня натолкнуло очень малое количество инфы по платформе, описание её плюсов и минусов. Стоит помнить, что платформа достаточно молодая (основным репозиториям 10-12 месяцев), поэтому это абсолютно нормальная ситуация.


## Первое приложение. Экосистема и первые грабли.
Для начала наверное стоит сказать, что изначально ни я, ни мои коллеги и не слышали о vk mini apps, впервые узнали о нем на открытии тем хакатона "цифровой прорыв", где одной из тем было создание бизнес приложения под данную платформу, любого. Видимо, таким образом с помощью хакатона, Вконтакте хочет привлечь разработчиков, что в принципе норм. Я уже лет 5 как пользуюсь kate mobile и не особо слежу за нововведениями, для меня Вконтакте это в первую очередь мессенджер с теми, кто всё ещё не в телеграмме, поэтому изначально эту тему ментально откинул в самый конец приоритета, однако глянув другие стало ясно, что как фронтендеру эта задача будет самой интересной. 5 минут гугления привели меня к следующему:
* Внутри используется react для представления, собственная библиотека компонентов и API для вызова событий vk и нативных штук.
* Мутная система дев сервера с отладкой через vk.
* Есть темплейт, можно будет хотя бы запустить и потыкать.
* Схема работы примерно следующая: в окошко вставляется билд вашего приложения, через него получается доступ к данным и методам вконтакте.

Конечно же, на тот момент кроме как с реактом я ни с чем из этого списка не сталкивался. Покопавшись 15 минут, я кое-как смог запустить темплейт и даже что-то поменять в нём, ура! На этом этапе возникла первая проблема: на локалхосте все вызовы vk bridge api не будут работать, единственный хорошо описанный вариант в официальном гайде это действовать через сервис ngrok, который создает https зеркало вашего локалхоста. Его следует открыть и держать запущенным (кстати зеркало активно в бесплатной версии максимум 8 часов) по порту, указанному в вашем приложении, затем в настройках приложения указать этот временный сайт. Это неудобно хотя бы потому, что зеркало постоянно падает, и эту цепочку действий приходится проделывать из разу в раз. Ну, хотя бы хот релоад работает. Также было непонятно, как через одно окно приложения работать двум разрабам. Уж не знаю как надо было делать, но нам пришлось создавать 3 приложения (моё, другого разработчика и деплой версию) под каждую ветку. Гораздо позднее я совершенно случайно обнаружил совершенно другой способ, который позволяет запускать это дело без танцев с бубном, но в офф. гайде новичок впервые сталкивается именно с первым вариантом. Также было несколько проблем с совместимостью версий вспомогательных библиотек vk ui, но скорее всего их уже пофиксили. Если игнорировать мелкие неудобства, описанные выше, то в целом экосистема мне понравилась. компоненты VK UI оказались очень приятными и понятными в использовании, единственной документации хватило, чтобы без проблем решить все задачи с интерфейсами. И это учитывая то, что с реактом я знаком был лишь по касательной.


## Второе приложение. Теперь с мостами.
После опыта хакатона с платформой мини аппов, мы решили попробовать выпустить что-нибудь коммерческое. Особо не выдумывая, сделали простенький рандомизатор с возможностью публикации результата в истории. Главным подводным камнем стала возможность перекидывания стикеров в историю: дело в том, что стикер может быть только в форматах jpg\png. Держать на клиенте 100 картинок не хотелось, а как генерировать картинки динамически на клиенте мы не придумали.  Ну окей, сделали сервер, на нём всё работает, но истории открываются пустыми. Почему? А вот сиди догадывайся, ведь Bridge API возвращает 200 даже если есть ошибки, вот так вот. А ещё может работать на андроиде и вылетать с рандомной ошибкой на IOS. А может и не вылетать, это как повезёт. Однако с получением информации о пользователе, вызовом нативной рекламы и прочими чуть более простыми вызовами проблем не было.  В общем Bridge API можно оценить на 6 из 10, не хватает лучшей поддержки кроссплатформы и обработки ошибок. 


## Заключение
Подводя итоги по платформе, можно выделить следующее:
*  Удобная библиотека компонентов для мобильных устройств, но не адаптированная под ПК.
* Не самый удобный способ отладки приложений.
* В целом работоспособный Bridge API, но не без недостатков.
* Практически нулевая конкуренция. В каталоге меньше 200 приложений!
* Прямой фидбек от платформы. После отправки на модерацию, поддержка даст советы по UX\UI и функционалу.
* В целом система полна трейдоффов, как и любая другая кроссплатформенная библиотека.
