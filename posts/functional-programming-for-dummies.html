<!DOCTYPE html><html data-saber-ssr><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="ie=edge" /><meta data-saber-head="ssr" name="generator" content="Saber v0.11.7"><meta data-saber-head="ssr" name="description" content="Небольшой бложик с статейками от молодого бойца переднего конца веб разработки." data-hid="description"><meta data-saber-head="ssr" name="description" content="Я человек практичный, поэтому когда я впервые увидел функциональный подход я малость приофигел. Какие-то странные функции которые передаются другим функциям как переменные, лямбда выражения, зачем это всё, ведь можно сделать куда проще? Но с течением времени мой код становился сложнее, циклы и условия становились всё вложеннее, а переменные изменялись всё в больших местах, и в один момент я понял - с этим что-то надо делать. Так я попробовал ФП ещё раз и начал искать ему практическое применение в рутинных задачах, делая их проще и понятнее.
"> <title>Функциональное программирование в JS для самых маленьких - Shymelon dev blog</title> <link data-saber-head="ssr" rel="alternate" title="Shymelon dev blog - Feed" type="application/atom+xml" href="/atom.xml"><style data-vue-ssr-id="0a1b13f7:0">blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,ol,p,pre,ul{margin:0;padding:0}body{font:400 16px/1.5 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;color:#111;background-color:#fdfdfd;-webkit-text-size-adjust:100%;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1;font-feature-settings:"kern" 1;font-kerning:normal;display:flex;min-height:100vh;flex-direction:column}blockquote,dl,figure,h1,h2,h3,h4,h5,h6,ol,p,pre,ul{margin-bottom:15px}main{display:block}img{max-width:100%;vertical-align:middle}figure>img{display:block}figcaption{font-size:14px}ol,ul{margin-left:30px}li>ol,li>ul{margin-bottom:0}h1,h2,h3,h4,h5,h6{font-weight:400}a{text-decoration:none;color:#000;cursor:pointer}a:visited{color:#1756a9}.link{position:relative;transition:clip-path 275ms ease}.link:focus span:before,.link:hover span:before{clip-path:polygon(0 0,100% 0,100% 100%,0 100%)}.link span{position:relative;display:inline-block;color:#2c2fe8}.link span:before{position:absolute;content:attr(data-content);color:#1619cb;text-decoration:underline;text-decoration-color:#1619cb;clip-path:polygon(0 0,0 0,0 100%,0 100%);transition:clip-path 275ms ease}.social-media-list a:hover{text-decoration:none}.social-media-list a:hover .username{text-decoration:underline}.link-resume{color:#000}.link-resume:visited{color:#595959}blockquote{color:#828282;border-left:4px solid #e8e8e8;padding-left:15px;font-size:18px;letter-spacing:-1px;font-style:italic}blockquote>:last-child{margin-bottom:0}code,pre{font-size:15px;border:1px solid #e8e8e8;border-radius:3px;background-color:#eef}code{padding:1px 5px}pre{padding:8px 12px;overflow-x:auto}pre>code{border:0;padding-right:0;padding-left:0}.wrapper{max-width:770px;margin-right:auto;margin-left:auto;padding-right:15px;padding-left:15px}@media screen and (min-width:800px){.wrapper{max-width:740px;padding-right:30px;padding-left:30px}}.footer-col-wrapper:after,.wrapper:after{content:"";display:table;clear:both}.orange{color:#f66a0a}.grey{color:#828282}.svg-icon{width:16px;height:16px;display:inline-block;fill:currentColor;padding:5px 3px 2px 5px;vertical-align:text-bottom}table{margin-bottom:30px;width:100%;text-align:left;color:#3f3f3f;border-collapse:collapse;border:1px solid #e8e8e8}table tr:nth-child(2n){background-color:#f7f7f7}table td,table th{padding:10px 15px}table th{background-color:#f0f0f0;border:1px solid #dedede;border-bottom-color:#c9c9c9}table td{border:1px solid #e8e8e8}.site-header{border-top:5px solid #424242;border-bottom:1px solid #e8e8e8;min-height:55.95px;line-height:54px;position:relative}.site-title{font-size:26px;font-weight:300;letter-spacing:-1px;margin-bottom:0;float:left}@media screen and (max-width:600px){.site-title{padding-right:45px}}.site-title,.site-title:visited{color:#424242}.site-nav{position:absolute;top:9px;right:15px;background-color:#fdfdfd;border:1px solid #e8e8e8;border-radius:5px;text-align:right}.site-nav .nav-trigger{display:none}.site-nav .menu-icon{float:right;width:36px;height:26px;line-height:0;padding-top:10px;text-align:center}.site-nav .menu-icon>svg path{fill:#424242}.site-nav label[for=nav-trigger]{display:block;float:right;width:36px;height:36px;z-index:2;cursor:pointer}.site-nav input~.trigger{clear:both;display:none}.site-nav input:checked~.trigger{display:block;padding-bottom:5px}.site-nav .page-link{color:#111;line-height:1.5;display:block;padding:5px 10px;margin-left:20px}.site-nav .page-link:not(:last-child){margin-right:0}@media screen and (min-width:600px){.site-nav{position:static;float:right;border:none;background-color:inherit}.site-nav .menu-icon,.site-nav label[for=nav-trigger]{display:none}.site-nav input~.trigger{display:block}.site-nav .page-link{display:inline;padding:0;margin-left:auto}.site-nav .page-link:not(:last-child){margin-right:20px}}.pagination{margin-bottom:25px;font-size:.875rem}.pagination .next-link,.pagination .prev-link{border:1px solid #e8e8e8;padding:5px 10px;color:#111}.site-footer{border-top:1px solid #e8e8e8;padding:30px 0}.footer-heading{font-size:18px;margin-bottom:15px}.contact-list,.social-media-list{list-style:none;margin-left:0}.footer-col-wrapper{font-size:15px;color:#828282;margin-left:-15px}.footer-col{width:-webkit-calc(100% - 15px);width:calc(100% - 15px);margin-bottom:15px;padding-left:15px}.footer-col-1,.footer-col-2{width:-webkit-calc(50% - 15px);width:calc(50% - 15px)}.footer-col-3{width:-webkit-calc(100% - 15px);width:calc(100% - 15px)}@media screen and (min-width:800px){.footer-col-1{width:-webkit-calc(35% - 15px);width:calc(35% - 15px)}.footer-col-2{width:-webkit-calc(20% - 15px);width:calc(20% - 15px)}.footer-col-3{width:-webkit-calc(45% - 15px);width:calc(45% - 15px)}}@media screen and (min-width:600px){.footer-col{float:left}}.page-content{min-height:50vh;padding:30px 0;flex:1 0 auto}.page-heading{font-size:32px}.post-list-heading{font-size:28px}.post-list{margin-left:0;list-style:none}.post-list>li{margin-bottom:30px}.post-meta{font-size:14px;color:#828282}.post-link{display:block;font-size:24px}.post-header{margin-bottom:30px}.post-content h1,.post-title{font-size:42px;letter-spacing:-1px;line-height:1}@media screen and (min-width:800px){.post-content h1,.post-title{font-size:42px}}.post-content{margin-bottom:30px}.post-content h2{font-size:28px}@media screen and (min-width:800px){.post-content h2{font-size:32px}}.post-content h3{font-size:22px}@media screen and (min-width:800px){.post-content h3{font-size:26px}}.post-content h4{font-size:18px}@media screen and (min-width:800px){.post-content h4{font-size:20px}}.social-media-list{display:table;margin:0 auto}.social-media-list li{float:left;margin:0 5px}.social-media-list li:first-of-type{margin-left:0}.social-media-list li:last-of-type{margin-right:0}.social-media-list li a{display:block;padding:7.5px;border:1px solid #e8e8e8}.social-media-list li:hover .svg-icon{fill:currentColor}.one-half{width:-webkit-calc(50% - 15px);width:calc(50% - 15px)}</style>  </head><body><div id="_saber" data-server-rendered="true"><div><header class="site-header"><div class="wrapper"><a href="/" rel="author" class="site-title router-link-active">Shymelon dev blog</a> <nav class="site-nav"><input type="checkbox" id="nav-trigger" class="nav-trigger"> <label for="nav-trigger"><span class="menu-icon"><svg viewBox="0 0 18 15" width="18px" height="15px"><path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path></svg></span></label> <div class="trigger"><a href="/" class="page-link router-link-active">Статьи</a><a href="/about.html" class="page-link">Обо мне</a></div></nav></div></header> <main aria-label="Content" class="page-content"><div class="wrapper"><article itemscope="itemscope" itemtype="http://schema.org/BlogPosting" class="post h-entry"><header class="post-header"><h1 itemprop="name headline" class="post-title p-name">Функциональное программирование в JS для самых маленьких</h1> <p class="post-meta"><time datetime="Mon Jul 20 2020 03:00:00 GMT+0300 (Moscow Standard Time)" itemprop="datePublished" class="dt-published">2020-07-20</time></p></header> <div itemprop="articleBody" class="post-content e-content"><h1 id="вступление">Вступление</h1> <p>Я человек практичный, поэтому когда я впервые увидел функциональный подход я малость приофигел. Какие-то странные функции которые передаются другим функциям как переменные, лямбда выражения, зачем это всё, ведь можно сделать куда проще? Но с течением времени мой код становился сложнее, циклы и условия становились всё вложеннее, а переменные изменялись всё в больших местах, и в один момент я понял - с этим что-то надо делать. Так я попробовал ФП ещё раз и начал искать ему практическое применение в рутинных задачах, делая их проще и понятнее.</p> <p>В этой статье я постараюсь максимально просто рассказать новичкам о том, как начать свои первые шаги в функциональном программировании и показать на реальном примере, как пользоваться ими с минимальными усилиями, без сложных понятий и теории функционального программирования.</p> <h2 id="disclaimer">Disclaimer</h2> <p>Я не претендую на последнюю инстанцию в этом вопросе, ровно, как и то, что это потребуется именно вам и тем более не собираюсь разводить холивар насчёт того какая парадигма лучше. Также стоит помнить, что нижеописанные советы лишь первый шаг, и они могут (и большинство должны!) использоваться и в объектно-ориентированном подходе.</p> <h2 id="never-gonna-let---">Never gonna let...</h2> <p>Для начала следует максимально избавиться в своем коде от переменных, заменив их константами. Зачем? Всё просто: чем чаще вы меняете переменную, тем больше условий и мест изменений надо удержать в голове. Для первых шагов достаточно полностью заменить let и var на const, это подстегнёт вас делать сразу две вещи: правильно называть переменные и писать меньше императивного кода (цикл for(const i = ...)  очевидно работать не будет, придётся искать замену в виде функций высшего порядка)</p> <h2 id="циклы-циклы">Циклы, циклы</h2> <p>Вторая вещь, которой учат в институте после переменных это циклы. Казалось бы, без переменных прожить можно, но без циклов-то как? Проще простого. <a rel="noopener noreferrer" target="_blank" href="https://learn.javascript.ru/array-iteration">Встроенные методы перебора JavaScript</a> покрывают 90% рутинных нужд в циклах. Описывать как ими пользоваться я не буду, это объясняют лучше меня по ссылке выше. Я же постараюсь как можно проще описать самые используемые и привести типичные юзкейсы.</p> <h3 id="map">map</h3> <p>Возвращает новый массив, над каждым элементом  поработала функция f(элемент_массива), которую вы передаёте в качестве первого аргумента. Типичные юзкейсы: получить из массива объектов массив из конкретного поля объектов, трансформировать каждое значение из массива.</p> <h3 id="filter-и-sort">filter и sort</h3> <p>Названия говорят сами за себя: первый метод фильтрует, второй сортирует.</p> <h3 id="reduce">reduce</h3> <p>А вот эта интереснее. На пальцах описать сложно, грубо говоря применяет функцию на каждый элемент массива с сохранением прошлого результата, возвращает его же. Используется когда надо сократить массив до одного значения, например найти сумму всех элементов массива или вернуть строку с перечислением элементов массива. Самый мощный из встроенных методов, но самый сложный для восприятия. Для полного понимания советую вывести какой-нибудь массив с помощью него и посмотреть, какое значение будет в каждом аргументе на каждой итерации, также не стоит забывать про аргумент initialValue.</p> <h3 id="foreach">forEach</h3> <p>Единственный метод из перечисленных, который ничего не возвращает. Классически его используют для замены цикла for, когда без побочных эффектов не обойтись. Например, для каждого из элементов массива отправить запрос на сервер.</p> <h2 id="практика">Практика</h2> <p>Попробуем отрефакторить какой-нибудь реальный пример с минимальным изменением в логике. Для чистоты эксперимента я залез на сайт с компонентами Vue и взял первый попавшийся на глаза репозиторий. Это компонент для Vue, который генерирует программную анимацию текста из случайных букв и цифр. Основной движ компонента происходит в следующих строчках:</p> <div class="saber-highlight" data-lang="javascript"><pre class="saber-highlight-code language-javascript"><code class="language-javascript">this.textRendered = &quot;&quot;;
                //create initial garble string
                for (var i = 0; i &lt; this.text.length; i++) {
                    if (this.text.charAt(i) != &quot; &quot;) {
                        this.textRendered += Math.random().toString(36).substr(2, 1);
                    } else {
                        this.textRendered += &quot; &quot;;
                    }
                }
                this.garbleInterval = setInterval(() =&gt; {
                    //by chance add either real char or another random
                    for (var i = 0; i &lt; this.text.length; i++) {
                        if (this.text.charAt(i) != &quot; &quot; &amp;&amp; this.text.charAt(i) != this
                            .textRendered.charAt(i)) {
                            if (Math.random() &gt; this.chance) {
                                //another random
                                this.textRendered = this.replaceAt(this.textRendered, i, Math
                                    .random().toString(36).substr(2, 1));
                            } else {
                                //the real one
                                this.textRendered = this.replaceAt(this.textRendered, i, this
                                    .text.charAt(i));
                            }
                        }
                    }</code></pre></div><p>Ухх. Для начала попробуем переписать 1 цикл. Всё что он делает, это просто проходит по символам в строке и меняет их на случайное значение. В отдельности выглядит несложно, но требует времени, чтобы понять что тут происходит и внимания, чтобы запомнить все изменяющиеся переменные. Для начала избавимся от цикла, он здесь явно лишний:</p> <div class="saber-highlight" data-lang="js"><pre class="saber-highlight-code language-js"><code class="language-js">this.textRendered = this.text.split('').map(v =&gt; v !== ' ' ? Math.random().toString(36).substr(2, 1)) : &quot; &quot;).join('');</code></pre></div><p>Без цикла выглядит компактнее, но неказистость и сумбурность в коде никуда не ушла, спасибо реализации рандомайзера. Вынесем её в отдельную функцию, тем более дальше по коду она нам ещё пригодится.</p> <div class="saber-highlight" data-lang="js"><pre class="saber-highlight-code language-js"><code class="language-js">const getRandomChar = () =&gt; Math.random().toString(36).substr(2, 1);
this.textRendered = this.text.split('').map(v =&gt; v !== ' ' ? getRandomChar() : &quot; &quot;).join('');</code></pre></div><p>Можно ли назвать этот код чисто функциональным? Абсолютно нет. Можно ли продолжить улучшать его? Разумеется. Но наша цель на данный момент улучшить качество при минимальных усилиях, а как известно 20% усилий приносят 80% результата.</p> <p>Следующий кусок кода более трудоёмкий, в нём нас ожидают классические грехи императивного подхода: циклы с условием, вложеность, дублирование кода. Для начала попробуем понять, что делают отдельные куски кода в условиях и вынести их в правильно именованные функции:</p> <div class="saber-highlight" data-lang="js"><pre class="saber-highlight-code language-js"><code class="language-js">this.text.charAt(i) != &quot; &quot; &amp;&amp; this.text.charAt(i) != this.textRendered.charAt(i)</code></pre></div><p>Проверяет должен ли меняться текущий символ или нет. Так и назовём:</p> <div class="saber-highlight" data-lang="js"><pre class="saber-highlight-code language-js"><code class="language-js">const shouldBeCharReplaced = (i) =&gt; this.text.charAt(i) != &quot; &quot; &amp;&amp; this.text.charAt(i) != this.textRendered.charAt(i);</code></pre></div><p>Хочу заметить, что мы используем внешние переменные в нашей функции, что не есть хорошо, но наша цель на сегодня не написать идеальный функциональный код, а сделать уже существующий код более читаемым с минимальными усилиями. Конечно же, в идеале мы бы хотели полностью переписать логику компонента, но предположим на нас давят сроки, а компонент нужен читаемым прямо сейчас.
Но что-то я отвлёкся. Далее:</p> <div class="saber-highlight" data-lang="js"><pre class="saber-highlight-code language-js"><code class="language-js">if (Math.random() &gt; this.chance) {
                                //another random
                                this.textRendered = this.replaceAt(this.textRendered, i, Math
                                    .random().toString(36).substr(2, 1));
                            } else {
                                //the real one
                                this.textRendered = this.replaceAt(this.textRendered, i, this
                                    .text.charAt(i));
                            }</code></pre></div><p>Меняет символ на текущем индексе на еще один рандом или настоящий в зависимости от коэфициента. Проще простого, к тому же вишенкой на торте мы видим код, который мы уже вынесли в отдельную функцию getRandomChar():</p> <div class="saber-highlight" data-lang="js"><pre class="saber-highlight-code language-js"><code class="language-js">const stringWithReplacedChar = (i) =&gt; {
    if(Math.random() &gt; this.chance) {
        return this.replaceAt(this.textRendered, i, getRandomChar())
        }
        return replaceAt(this.textRendered, i, this.text.charAt(i));
}</code></pre></div><p>Осталось избавиться от цикла и соединить всё вместе. Т.к. в реализации автор внутри цикла каждый раз меняет всю строку, а изначальную реализацию мы решили не трогать из-за якобы горящих сроков, то придётся использовать forEach, который чаще всего используется для обработки побочных эффектов.</p> <div class="saber-highlight" data-lang="js"><pre class="saber-highlight-code language-js"><code class="language-js">// _ используем как плейсхолдер для ненужного нам значения
text.split('').forEach((_,i) =&gt; {
    if(shouldBeCharReplaced(i)) {
        textRendered = stringWithReplacedChar(i);
    }
})</code></pre></div><p>Полный результат рефакторинга:</p> <div class="saber-highlight" data-lang="js"><pre class="saber-highlight-code language-js"><code class="language-js">const getRandomChar = () =&gt; Math.random().toString(36).substr(2, 1);

const shouldBeCharReplaced = (i) =&gt; this.text.charAt(i) != &quot; &quot; &amp;&amp; this.text.charAt(i) != this.textRendered.charAt(i);

//by chance add either real char or another random
const stringWithReplacedChar = (i) =&gt; {
    if(Math.random() &gt; this.chance) {
        //another random
        return this.replaceAt(this.textRendered, i, getRandomChar());
        }
        //the real one
        return replaceAt(this.textRendered, i, this.text.charAt(i));
}

//create initial garble string
this.textRendered = this.text.split('').map(v =&gt; v !== ' ' ? getRandomChar() : &quot; &quot;).join('');

text.split('').forEach((_,i) =&gt; {
    if(shouldBeCharReplaced(i)) {
        this.textRendered = stringWithReplacedChar(i);
    }
})</code></pre></div><p>В итоге теперь, чтобы понять, как работает компонент, нам необходимо посмотреть лишь на последние 6 строк вместо первоначальных циклов и вложенных условий. Конечно, будь у нас больше времени, мы бы могли в разы улучшить и данный пример. Например использовать композицию, сделать переменные максимально неизменяемыми, полностью избавиться от условий и побочных эффектов, но это уже тема для другой статьи (:</p></div> <!----> <a href="/posts/functional-programming-for-dummies.html" aria-current="page" hidden="hidden" class="u-url router-link-exact-active router-link-active"></a></article></div></main> <footer class="site-footer h-card"><div class="wrapper"><div class="footer-col-wrapper"><div class="footer-col one-half"><h2 class="footer-heading">Shymelon dev blog</h2> <ul class="contact-list"><li class="p-name">Shymelon</li> <li><a href="mailto:shymelon.dev@gmail.com" class="u-email">shymelon.dev@gmail.com</a></li> <li><a rel="noopener noreferrer" target="_blank" href="https://shymelon.github.io/my-resume/" class="link-resume">Резюме</a></li></ul></div> <div class="footer-col one-half"><p>Небольшой бложик с статейками от молодого бойца переднего конца веб разработки.</p></div> <div class="social-links"><ul class="social-media-list"><!----> <!----> <!----> <li><a title="shymelon" rel="noopener noreferrer" target="_blank" href="https://github.com/shymelon"><svg class="svg-icon grey"><use xlink:href="/_saber/images/minima-social-icons.198a7e12.svg#github"></use></svg></a></li> <!----> <!----> <!----> <!----> <!----> <li><a title="shymelon" rel="noopener noreferrer" target="_blank" href="https://t.me/shymelon"><svg class="svg-icon grey"><use xlink:href="/_saber/images/minima-social-icons.198a7e12.svg#telegram"></use></svg></a></li> <!----> <!----> <!----></ul></div></div></div></footer></div></div><script src="/_saber/js/client.7d004c56.js" defer></script><script src="/_saber/js/page--_posts-functional-programming-for-dummies-md.ca0e66f5.js" defer></script></body></html>
